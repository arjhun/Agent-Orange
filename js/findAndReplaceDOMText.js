/**
 * findAndReplaceDOMText v 0.4.3
 * @author James Padolsey http://james.padolsey.com
 * @license http://unlicense.org/UNLICENSE
 *
 * Matches the text of a DOM node against a regular expression
 * and replaces each match (or node-separated portions of the match)
 * in the specified element.
 */

 !function(a,b){"object"==typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.findAndReplaceDOMText=b()}(this,function(){function f(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function g(){return h.apply(null,arguments)||i.apply(null,arguments)}function h(a,b,c,d,e){if(b&&!b.nodeType&&arguments.length<=2)return!1;var f="function"==typeof c;f&&(c=function(a){return function(b,c){return a(b.text,c.startIndex)}}(c));var h=i(b,{find:a,wrap:f?null:c,replace:f?c:"$"+(d||"&"),prepMatch:function(a,b){if(!a[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(d>0){var c=a[d];a.index+=a[0].indexOf(c),a[0]=c}return a.endIndex=a.index+a[0].length,a.startIndex=a.index,a.index=b,a},filterElements:e});return g.revert=function(){return h.revert()},!0}function i(a,b){return new j(a,b)}function j(a,c){var d=c.preset&&g.PRESETS[c.preset];if(c.portionMode=c.portionMode||b,d)for(var f in d)e.call(d,f)&&!e.call(c,f)&&(c[f]=d[f]);this.node=a,this.options=c,this.prepMatch=c.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var b="retain",c="first",d=document,e={}.hasOwnProperty;return g.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1},g.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1},g.NON_INLINE_PROSE=function(a){return e.call(g.NON_CONTIGUOUS_PROSE_ELEMENTS,a.nodeName.toLowerCase())},g.PRESETS={prose:{forceContext:g.NON_INLINE_PROSE,filterElements:function(a){return!e.call(g.NON_PROSE_ELEMENTS,a.nodeName.toLowerCase())}}},g.Finder=j,j.prototype={search:function(){function i(e){for(var f=0,j=e.length;f<j;++f){var k=e[f];if("string"==typeof k){if(d.global)for(;a=d.exec(k);)g.push(h.prepMatch(a,b++,c));else(a=k.match(d))&&g.push(h.prepMatch(a,0,c));c+=k.length}else i(k)}}var a,b=0,c=0,d=this.options.find,e=this.restoreAggregateText(),g=[],h=this;return d="string"==typeof d?RegExp(f(d),"g"):d,i(e),g},prepMatch:function(a,b,c){if(!a[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return a.endIndex=c+a.index+a[0].length,a.startIndex=c+a.index,a.index=b,a},restoreAggregateText:function(){function c(d){if(3===d.nodeType)return[d.data];if(a&&!a(d))return[];var e=[""],f=0;if(d=d.firstChild)do if(3!==d.nodeType){var g=c(d);b&&1===d.nodeType&&(b===!0||b(d))?(e[++f]=g,e[++f]=""):("string"==typeof g[0]&&(e[f]+=g.shift()),g.length&&(e[++f]=g,e[++f]=""))}else e[f]+=d.data;while(d=d.nextSibling);return e}var a=this.options.filterElements,b=this.options.forceContext;return c(this.node)},processMatches:function(){var d,e,l,a=this.matches,b=this.node,c=this.options.filterElements,f=[],g=b,h=a.shift(),i=0,j=0,k=0,m=[b];a:for(;;){if(3===g.nodeType&&(!e&&g.length+i>=h.endIndex?e={node:g,index:k++,text:g.data.substring(h.startIndex-i,h.endIndex-i),indexInMatch:i-h.startIndex,indexInNode:h.startIndex-i,endIndexInNode:h.endIndex-i,isEnd:!0}:d&&f.push({node:g,index:k++,text:g.data,indexInMatch:i-h.startIndex,indexInNode:0}),!d&&g.length+i>h.startIndex&&(d={node:g,index:k++,indexInMatch:0,indexInNode:h.startIndex-i,endIndexInNode:h.endIndex-i,text:g.data.substring(h.startIndex-i,h.endIndex-i)}),i+=g.data.length),l=1===g.nodeType&&c&&!c(g),d&&e){if(g=this.replaceMatch(h,d,f,e),i-=e.node.data.length-e.endIndexInNode,d=null,e=null,f=[],h=a.shift(),k=0,j++,!h)break}else if(!l&&(g.firstChild||g.nextSibling)){g.firstChild?(m.push(g),g=g.firstChild):g=g.nextSibling;continue}for(;;){if(g.nextSibling){g=g.nextSibling;break}if(g=m.pop(),g===b)break a}}},revert:function(){for(var a=this.reverts.length;a--;)this.reverts[a]();this.reverts=[]},prepareReplacementString:function(a,b,d){var e=this.options.portionMode;return e===c&&b.indexInMatch>0?"":(a=a.replace(/\$(\d+|&|`|')/g,function(a,b){var c;switch(b){case"&":c=d[0];break;case"`":c=d.input.substring(0,d.startIndex);break;case"'":c=d.input.substring(d.endIndex);break;default:c=d[+b]}return c}),e===c?a:b.isEnd?a.substring(b.indexInMatch):a.substring(b.indexInMatch,b.indexInMatch+b.text.length))},restorePortionReplacementNode:function(a,b){var c=this.options.replace||"$&",e=this.options.wrap;if(e&&e.nodeType){var f=d.createElement("div");f.innerHTML=e.outerHTML||(new XMLSerializer).serializeToString(e),e=f.firstChild}if("function"==typeof c)return c=c(a,b),c&&c.nodeType?c:d.createTextNode(String(c));var g="string"==typeof e?d.createElement(e):e;return c=d.createTextNode(this.prepareReplacementString(c,a,b)),c.data&&g?(g.appendChild(c),g):c},replaceMatch:function(a,b,c,e){var h,i,f=b.node,g=e.node;if(f===g){var j=f;b.indexInNode>0&&(h=d.createTextNode(j.data.substring(0,b.indexInNode)),j.parentNode.insertBefore(h,j));var k=this.restorePortionReplacementNode(e,a);return j.parentNode.insertBefore(k,j),e.endIndexInNode<j.length&&(i=d.createTextNode(j.data.substring(e.endIndexInNode)),j.parentNode.insertBefore(i,j)),j.parentNode.removeChild(j),this.reverts.push(function(){h===k.previousSibling&&h.parentNode.removeChild(h),i===k.nextSibling&&i.parentNode.removeChild(i),k.parentNode.replaceChild(j,k)}),k}h=d.createTextNode(f.data.substring(0,b.indexInNode)),i=d.createTextNode(g.data.substring(e.endIndexInNode));for(var l=this.restorePortionReplacementNode(b,a),m=[],n=0,o=c.length;n<o;++n){var p=c[n],q=this.restorePortionReplacementNode(p,a);p.node.parentNode.replaceChild(q,p.node),this.reverts.push(function(a,b){return function(){b.parentNode.replaceChild(a.node,b)}}(p,q)),m.push(q)}var r=this.restorePortionReplacementNode(e,a);return f.parentNode.insertBefore(h,f),f.parentNode.insertBefore(l,f),f.parentNode.removeChild(f),g.parentNode.insertBefore(r,g),g.parentNode.insertBefore(i,g),g.parentNode.removeChild(g),this.reverts.push(function(){h.parentNode.removeChild(h),l.parentNode.replaceChild(f,l),i.parentNode.removeChild(i),r.parentNode.replaceChild(g,r)}),r}},g});
